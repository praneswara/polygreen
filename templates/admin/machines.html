{% extends "admin/base.html" %}
{% block title %}Machines{% endblock %}

{% block content %}
<style>
  .card-title{
    font-size: 25px;
    color:#006d71;
  }
  .btn.full{
 
  background-color: #ff0000;
  border-radius: 20px;
  color:white;
  padding: 4px;
}
 .btn.available{
  
  background-color: #096709;
  border-radius: 20px;
  color:white;
    padding: 5px;
 font-size: 12px;
}

.inner-card{
  display: flex;
  justify-content: space-between;
}
@media only screen and (max-width: 1000px) {
 .inner-card{
   align-items: center;
   /* justify-content: center; */
}
 } 
 .detail{
  background-color:#006d71 ;
  color: white;
  font-weight: 500;
  border-radius: 10px;
 } 
 .detail:hover{
   background-color: #029297;
   color:white;
 }
 .addnew{
  background-color: rgb(35, 35, 218);
  color:white;
  font-size: 18px;
  
 }
 .addnew:hover{
   background-color: rgb(71, 71, 223);
     color:white;
  font-size: 18px;
 }
</style>
<h2 class="mb-4 text-center">Í∏∞Í≥Ñ</h2>
<input 
    type="text"
    id="machineSearch"
    class="form-control mb-3"
    placeholder="üîç Í∏∞Í≥Ñ ID, Ïù¥Î¶Ñ, ÎèÑÏãú Í≤ÄÏÉâ..."
    onkeyup="filterMachines()">

<div class="row">
  {% for machine in machines %}
  <div class="col-md-6 ">
    <div class="card mb-3 shadow machine-card">
      <div class="card-body">
          <div class="inner-card">     
             <h5 class="card-title machine-name">{{ machine.name }} (<span class="machine-id">{{ machine.machine_id }}</span>)</h5>
                   <p class="btn {% if machine.is_full %}full{% else %}available{% endif %} machine-status">
    <strong>{% if machine.is_full %}Í∞ÄÎìùÌïú{% else %}ÏÇ¨Ïö© Í∞ÄÎä•{% endif %}</strong>
</p>
           </div>

                     <p><img src="{{ url_for('static', filename='building.png')}}" 
                alt="clean" width="30" height="30" class="m-1"><strong class="machine-city">{{ machine.city }}</strong></p>
                       <p> <a href="{{ url_for('admin_machine_detail', machine_id=machine.machine_id) }}" class="btn detail">ÏÑ∏Î∂Ä</a></p>

      

        <!-- <p class="card-text"><strong>City:</strong> {{ machine.city }}</p> -->
        <!-- <p class="card-text"><strong>Status:</strong>{% if machine.is_full %}Full{% else %}Available{% endif %}</p> -->

      </div>
    </div>
  </div>
  {% endfor %}
</div>
<a href="{{ url_for('admin_add_machine') }}" class="btn mt-3 mb-3 addnew"><img src="{{ url_for('static', filename='plus..png')}}" 
             alt="plus" width="25" height="25" >   ÏÉà Í∏∞Í≥Ñ Ï∂îÍ∞Ä</a>
<button class="btn btn-primary" onclick="downloadMachinesPDF()">üìÑ Download Machines PDF</button>

<script>
function filterMachines() {
    let input = document.getElementById("machineSearch").value.toLowerCase();
    let cards = document.querySelectorAll(".machine-card");

    cards.forEach(card => {
        let text = card.innerText.toLowerCase();
        card.style.display = text.includes(input) ? "" : "none";
    });
}
  function downloadMachinesPDF() {

    const cards = document.querySelectorAll(".machine-card");
    let filtered = [];

    cards.forEach(card => {
        if (card.style.display !== "none") {

            let machine_id = card.querySelector(".machine-id").innerText.trim();
            let name = card.querySelector(".machine-name").innerText.trim();
            let city = card.querySelector(".machine-city").innerText.trim();
            let status = card.querySelector(".machine-status").innerText.trim();

            filtered.push({
                machine_id,
                name,
                city,
                status
            });
        }
    });

    fetch("/admin/machines/report", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ data: filtered })
    })
    .then(res => res.blob())
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "filtered_machines.pdf";
        a.click();
    });
}
</script>

{% endblock %}



